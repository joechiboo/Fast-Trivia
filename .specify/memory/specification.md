# Fast Trivia - 產品規格文件

## 1. 專案概述

### 願景
打造一個快節奏、易上手的多人即時問答遊戲，讓玩家可以隨時隨地透過手機與朋友競技，測試知識並享受競爭的樂趣。

### 目標
- 提供流暢的多人即時連線問答體驗
- 支援 2-8 人同時遊玩
- 手機優先的使用者介面設計
- 快速配對和遊戲開始流程（< 1 分鐘）
- 作為作品集展示前端、後端和即時通訊技術能力

### 非目標
- 不支援單人練習模式（階段一）
- 不提供好友系統或社交功能（階段一）
- 不儲存歷史戰績（階段一）
- 不支援語音或視訊通話
- 不支援自訂題庫上傳（階段一）

## 2. 使用者故事

### 主要使用場景：朋友聚會
**身為玩家**，我希望能夠：
- 快速創建一個遊戲房間，並分享房間代碼給朋友
- 在手機上輕鬆操作，不需要複雜的設定
- 看到所有玩家的即時分數排名
- 享受緊張刺激的倒數計時答題體驗
- 在遊戲結束後看到最終排名和統計資料

### 使用場景：等待時間的娛樂
**身為臨時想玩的玩家**，我希望能夠：
- 透過房間代碼快速加入朋友的遊戲
- 遊戲流程簡單直覺，不需要學習複雜規則
- 能在短時間內完成一局遊戲（5-10 分鐘）
- 如果斷線能夠重新連線繼續遊戲

### 使用場景：展示作品
**身為開發者**，我希望這個專案能夠：
- 清楚展示前端和後端技術能力
- 展現即時通訊和狀態同步的處理能力
- 有良好的程式碼架構和可讀性
- 部署在線上供面試官實際體驗

## 3. 功能需求

### 3.1 房間管理系統

#### 創建房間
- 玩家輸入暱稱（2-12 字元，中英文皆可）
- 系統自動生成 6 位房間代碼（英數字）
- 創建者自動成為房主
- 房間最多容納 8 人

#### 加入房間
- 玩家輸入暱稱和房間代碼
- 驗證房間是否存在且未滿
- 成功加入後進入等候室

#### 等候室
- 顯示所有已加入的玩家列表
- 房主可以看到「開始遊戲」按鈕
- 非房主看到「等待房主開始遊戲」提示
- 玩家可以離開房間
- 即時更新玩家列表（有人加入/離開）

#### 房間生命週期
- 房主離開時，自動指派下一位玩家為房主
- 所有玩家離開後，房間自動關閉
- 遊戲開始後，不允許新玩家加入

### 3.2 遊戲設定

#### 可設定項目
- **題目分類**（單選）：
  - 科學
  - 科技
  - 歷史
  - 娛樂
  - 綜合（隨機混合）

#### 固定設定
- **題數**: 固定 5 題（快速對戰）
- **難度**: 不分難度，所有題目統一計分

#### 設定權限
- 只有房主可以選擇題目分類
- 設定完成後點擊「開始遊戲」

### 3.3 遊戲流程

#### 準備階段
- 3 秒倒數動畫（3、2、1、Go!）
- 所有玩家同步看到倒數

#### 答題階段
每一題包含：
- **題目顯示**：清楚顯示問題文字
- **選項按鈕**：4 個選項（A、B、C、D），大按鈕設計
- **倒數計時**：10 秒倒數，視覺化進度條
- **選擇回饋**：點擊後按鈕變色，等待其他玩家
- **時間到提示**：倒數結束後，未作答視為放棄

#### 結果顯示階段
- **正確答案揭曉**：高亮顯示正確選項
- **答對/答錯回饋**：
  - 答對：綠色勾勾 + 獲得分數
  - 答錯：紅色叉叉 + 顯示你的錯誤選項
  - 未作答：灰色提示
- **即時排名**：顯示當前所有玩家分數排名（前三名）
- **連勝提示**：如果連續答對，顯示 "Combo x2!" 等提示
- **5 秒後自動進入下一題**

#### 最終結果階段
- **冠亞季軍展示**：
  - 第一名：金牌 🥇
  - 第二名：銀牌 🥈
  - 第三名：銅牌 🥉
- **完整排行榜**：顯示所有玩家的最終分數
- **個人統計**：
  - 答對題數 / 總題數
  - 正確率
  - 最高連勝
  - 總得分
- **再來一局按鈕**：返回等候室（房間不變）
- **離開房間按鈕**：返回首頁

### 3.4 計分系統

#### 計分公式
```
單題得分 = 基礎分 + 時間加成 + 連勝加成

基礎分 = 100 分
時間加成 = (剩餘秒數 / 10) × 50 分（最高 50 分）
連勝加成 = 連勝數 × 20 分（無上限）
```

#### 計分範例
**剩餘 8 秒，連勝 3 題**：
```
得分 = 100 + (8/10 × 50) + (3 × 20)
     = 100 + 40 + 60
     = 200 分
```

**剩餘 2 秒，連勝 0 題**：
```
得分 = 100 + (2/10 × 50) + 0
     = 100 + 10
     = 110 分
```

**剩餘 10 秒，連勝 5 題（滿分範例）**：
```
得分 = 100 + (10/10 × 50) + (5 × 20)
     = 100 + 50 + 100
     = 250 分
```

#### 連勝規則
- 連續答對才計算連勝
- 答錯或未作答會中斷連勝，歸零
- 連勝加成即時顯示在 UI 上

### 3.5 斷線處理

#### 短暫斷線（< 30 秒）
- 自動重連機制
- 重連後恢復到當前遊戲狀態
- 如果當題已超時，視為未作答

#### 長時間斷線（> 30 秒）
- 該玩家從遊戲中移除
- 其他玩家繼續遊戲
- 斷線玩家無法再加入該局遊戲

#### 房主斷線
- 自動轉移房主權限給下一位玩家
- 遊戲繼續進行

### 3.6 題庫系統

#### 題目結構
```typescript
interface Question {
  id: string;
  category: 'science' | 'technology' | 'history' | 'entertainment';
  question: string;
  options: [string, string, string, string]; // 4 個選項
  correctAnswer: 0 | 1 | 2 | 3; // 正確答案的索引
  explanation?: string; // 選用：答案解釋
}
```

#### 題庫規模（階段一）
- 每個分類至少 20 題
- 總計至少 80 題

#### 題目選取邏輯
- 根據設定的分類篩選
- 隨機抽取 5 題，不重複（同一局內）
- 所有玩家看到相同的題目順序

## 4. 技術規格

### 4.1 專案架構

```
fast-trivia/
├── client/                    # 前端專案
│   ├── src/
│   │   ├── components/        # Vue 元件
│   │   │   ├── Home.vue
│   │   │   ├── Lobby.vue
│   │   │   ├── GameSettings.vue
│   │   │   ├── Countdown.vue
│   │   │   ├── Question.vue
│   │   │   ├── Result.vue
│   │   │   ├── FinalScoreboard.vue
│   │   │   └── PlayerList.vue
│   │   ├── composables/       # Vue Composables
│   │   │   ├── useSocket.ts
│   │   │   └── useGame.ts
│   │   ├── stores/            # Pinia Stores
│   │   │   └── game.ts
│   │   ├── types/             # TypeScript 類型定義
│   │   │   └── game.types.ts
│   │   ├── utils/             # 工具函式
│   │   │   └── score.ts
│   │   ├── App.vue
│   │   └── main.ts
│   ├── public/
│   ├── package.json
│   └── tailwind.config.js
│
├── server/                    # 後端專案
│   ├── src/
│   │   ├── index.ts           # 伺服器入口
│   │   ├── socket/            # Socket.io 邏輯
│   │   │   ├── handlers/
│   │   │   │   ├── room.ts
│   │   │   │   ├── game.ts
│   │   │   │   └── player.ts
│   │   │   └── events.ts
│   │   ├── game/              # 遊戲邏輯
│   │   │   ├── Room.ts
│   │   │   ├── Game.ts
│   │   │   └── Player.ts
│   │   ├── data/              # 題庫資料
│   │   │   └── questions.json
│   │   └── types/
│   │       └── game.types.ts
│   ├── package.json
│   └── tsconfig.json
│
├── .specify/                  # Spec Kit 規格文件
│   └── memory/
│       ├── constitution.md
│       └── specification.md
├── README.md
└── .gitignore
```

### 4.2 前端技術細節

#### 狀態管理
- 使用 Pinia 管理全域遊戲狀態
- 使用 Composables 封裝可重用的邏輯

#### Socket.io 事件處理
**客戶端發送**：
- `create_room` - 創建房間
- `join_room` - 加入房間
- `leave_room` - 離開房間
- `start_game` - 開始遊戲（房主）
- `submit_answer` - 提交答案
- `next_question` - 準備下一題

**客戶端接收**：
- `room_created` - 房間創建成功
- `room_joined` - 加入房間成功
- `player_joined` - 有玩家加入
- `player_left` - 有玩家離開
- `game_started` - 遊戲開始
- `question` - 收到題目
- `answer_submitted` - 其他玩家已作答（不含答案）
- `question_result` - 本題結果
- `game_ended` - 遊戲結束
- `error` - 錯誤訊息

#### UI 動畫
- Tailwind CSS Transitions
- CSS Animations（倒數、按鈕點擊回饋）
- Vue Transition（頁面切換，選用）

### 4.3 後端技術細節

#### 資料結構

**Room（房間）**
```typescript
class Room {
  id: string;              // 房間代碼
  hostId: string;          // 房主 ID
  players: Map<string, Player>;
  game: Game | null;
  settings: GameSettings;
  maxPlayers: number = 8;
}
```

**Player（玩家）**
```typescript
class Player {
  id: string;              // Socket ID
  name: string;            // 暱稱
  score: number;           // 總分
  currentStreak: number;   // 當前連勝
  answers: Answer[];       // 答題記錄
}
```

**Game（遊戲）**
```typescript
class Game {
  roomId: string;
  questions: Question[];
  currentQuestionIndex: number;
  status: 'waiting' | 'countdown' | 'question' | 'result' | 'ended';
  startTime: number;
  answerDeadline: number;
}
```

**GameSettings（遊戲設定）**
```typescript
interface GameSettings {
  category: 'science' | 'technology' | 'history' | 'entertainment' | 'mixed';
  questionCount: 5; // 固定 5 題
}
```

#### 遊戲狀態機
```
WAITING (等候室)
  ↓ start_game
COUNTDOWN (倒數 3 秒)
  ↓ 自動
QUESTION (答題階段，10 秒)
  ↓ 所有人作答完 或 時間到
RESULT (顯示結果，5 秒)
  ↓ 自動
QUESTION (下一題) 或 ENDED (遊戲結束)
```

#### 計分邏輯
- 伺服器端計算分數，避免前端作弊
- 記錄每個玩家的作答時間戳
- 驗證答案正確性
- 追蹤連勝狀態

#### 房間清理機制
- 空房間 30 分鐘後自動清除
- 遊戲結束後 10 分鐘未開始新遊戲，房間清除

### 4.4 通訊協定

#### WebSocket 訊息格式
```typescript
// 通用回應格式
interface SocketResponse<T = any> {
  success: boolean;
  data?: T;
  error?: string;
}

// 創建房間
Client -> Server: create_room
{
  playerName: string;
}

Server -> Client: room_created
{
  success: true,
  data: {
    roomId: string;
    playerId: string;
    playerName: string;
  }
}

// 加入房間
Client -> Server: join_room
{
  roomId: string;
  playerName: string;
}

Server -> All in Room: player_joined
{
  players: Array<{ id: string; name: string; }>
}

// 提交答案
Client -> Server: submit_answer
{
  roomId: string;
  playerId: string;
  questionId: string;
  answerIndex: number;
  timestamp: number;
}

// 題目結果
Server -> All in Room: question_result
{
  correctAnswer: number;
  scoreboard: Array<{
    playerId: string;
    playerName: string;
    score: number;
    isCorrect: boolean;
    earnedPoints: number;
    currentStreak: number;
  }>;
}
```

## 5. UI/UX 設計

### 5.1 設計原則
- **行動優先**：所有介面先為手機設計
- **大按鈕**：主要操作按鈕至少 44x44px
- **清楚的視覺層級**：使用大小、顏色、間距區分重要性
- **即時回饋**：所有操作都有視覺回饋
- **簡潔的文字**：避免冗長說明

### 5.2 色彩設計

#### 主色調
- **主色**：紫色系 (#8B5CF6) - 科技感、活力
- **次色**：藍色系 (#3B82F6) - 專業、信任
- **強調色**：粉色系 (#EC4899) - 重要操作

#### 功能色
- **正確**：綠色 (#10B981)
- **錯誤**：紅色 (#EF4444)
- **警告**：黃色 (#F59E0B)
- **資訊**：藍色 (#3B82F6)

#### 背景
- 漸層背景：從紫色到藍色
- 卡片：白色半透明 (rgba(255, 255, 255, 0.9))

### 5.3 排版

#### 字體
- 主要字體：系統字體棧（-apple-system, BlinkMacSystemFont, "Segoe UI"）
- 中文優化：支援繁體中文顯示

#### 字級
- **特大標題**：32px - 房間代碼、倒數數字
- **大標題**：24px - 頁面標題
- **中標題**：20px - 卡片標題
- **正文**：16px - 一般文字
- **小字**：14px - 說明文字

### 5.4 頁面設計

#### 首頁
```
┌─────────────────────────┐
│   Fast Trivia 🎯       │
│   快速問答競賽          │
│                         │
│   [輸入你的暱稱]        │
│                         │
│   [ 創建房間 ]          │
│                         │
│   ─── 或 ───            │
│                         │
│   [輸入房間代碼]        │
│   [ 加入房間 ]          │
└─────────────────────────┘
```

#### 等候室
```
┌─────────────────────────┐
│   房間代碼: ABC123      │
│   [複製]                │
│                         │
│   玩家列表 (3/8)        │
│   👑 Alice              │
│   😊 Bob                │
│   😊 Carol              │
│                         │
│   [開始遊戲] (房主)      │
│   等待房主開始... (其他) │
│                         │
│   [離開房間]            │
└─────────────────────────┘
```

#### 遊戲設定（房主）
```
┌─────────────────────────┐
│   選擇題目分類          │
│                         │
│   ( ) 科學 🔬           │
│   (•) 科技 💻           │
│   ( ) 歷史 📚           │
│   ( ) 娛樂 🎬           │
│   ( ) 綜合 🎯           │
│                         │
│   共 5 題               │
│                         │
│   [ 開始遊戲 ]          │
└─────────────────────────┘
```

#### 答題畫面
```
┌─────────────────────────┐
│   題目 3/5         ⏱ 8s │
│   ──────────────── (進度條)
│                         │
│   以下何者是程式語言？   │
│                         │
│   [ A. HTML ]           │
│   [ B. CSS ]            │
│   [ C. Python ]         │
│   [ D. JSON ]           │
│                         │
│   🏆 排行榜             │
│   1. Alice - 850        │
│   2. Bob - 720          │
│   3. Carol - 680        │
└─────────────────────────┘
```

#### 結果顯示
```
┌─────────────────────────┐
│   ✓ 正確答案：C         │
│                         │
│   你答對了！+120 分      │
│   🔥 連勝 x3!           │
│                         │
│   🏆 目前排名           │
│   🥇 Alice - 970 (+120) │
│   🥈 Bob - 720 (+0)     │
│   🥉 Carol - 800 (+120) │
│                         │
│   5 秒後進入下一題...    │
└─────────────────────────┘
```

#### 最終結果
```
┌─────────────────────────┐
│   🎉 遊戲結束！         │
│                         │
│   🥇 Alice - 1850       │
│   🥈 Carol - 1650       │
│   🥉 Bob - 1420         │
│                         │
│   你的成績：第 2 名      │
│   答對：8/10 (80%)      │
│   最高連勝：5 題         │
│   總得分：1650          │
│                         │
│   [ 再來一局 ]          │
│   [ 離開房間 ]          │
└─────────────────────────┘
```

### 5.5 互動設計

#### 按鈕狀態
- **預設**：紫色背景，白色文字
- **懸停**：稍微變深
- **點擊**：縮小動畫
- **禁用**：灰色半透明

#### 答題選項狀態
- **未選擇**：白色背景，黑色文字
- **已選擇（等待中）**：紫色背景，白色文字
- **正確答案（結果階段）**：綠色背景
- **錯誤選擇（結果階段）**：紅色背景
- **未選擇（結果階段）**：灰色背景

#### 倒數計時
- 10-6 秒：綠色進度條
- 5-3 秒：黃色進度條
- 2-0 秒：紅色進度條 + 閃爍

### 5.6 響應式設計

#### 手機（< 640px）
- 單欄布局
- 全寬按鈕
- 較大的文字和間距

#### 平板（640px - 1024px）
- 可以適當增加內容寬度
- 雙欄布局（如遊戲設定）

#### 桌面（> 1024px）
- 限制最大寬度（600px）
- 置中顯示
- 可以顯示更多資訊

## 6. 成功指標

### 質化指標
- ✅ 遊戲流程順暢，無明顯卡頓
- ✅ 手機操作體驗良好，按鈕大小適中
- ✅ 多人連線穩定，無頻繁斷線
- ✅ UI 設計美觀，符合現代網頁標準
- ✅ 程式碼結構清晰，易於維護和擴充

### 量化指標
- ✅ 首次載入時間 < 3 秒
- ✅ WebSocket 延遲 < 100ms
- ✅ 動畫幀率 ≥ 55fps
- ✅ 支援最多 8 人同時遊戲
- ✅ 斷線重連成功率 > 90%（30 秒內）
- ✅ 題庫數量 ≥ 100 題（階段一）
- ✅ 跨瀏覽器相容（Chrome, Safari, Firefox, Edge）

### 作品集展示指標
- ✅ 可在線上直接遊玩，無需安裝
- ✅ README 包含完整的技術說明
- ✅ 程式碼有適當的註解和文件
- ✅ 展示前端、後端、即時通訊三項技術能力
- ✅ 有清楚的架構圖和技術說明

## 7. 實作階段

### 階段一：核心 MVP（1-2 週）
**目標**：實現基本的多人問答功能

#### 前端
- [ ] 基本頁面結構（Home, Lobby, Game, Result）
- [ ] Socket.io 客戶端整合
- [ ] 房間創建/加入功能
- [ ] 答題和計分 UI
- [ ] 基本響應式設計

#### 後端
- [ ] Express + Socket.io 伺服器設定
- [ ] 房間管理邏輯
- [ ] 遊戲狀態機
- [ ] 題庫系統（100 題）
- [ ] 計分系統

#### 部署
- [ ] 前端部署到 Vercel
- [ ] 後端部署到 Render
- [ ] 環境變數設定
- [ ] CORS 設定

**完成標準**：
- 2-4 人可以順利進行一局完整的遊戲
- 計分系統正確運作
- 基本的手機適配

### 階段二：體驗優化（1 週）
**目標**：提升 UI/UX 和穩定性

- [ ] 優化動畫效果（倒數、答案揭曉）
- [ ] 加入音效（選用）
- [ ] 改善載入狀態提示
- [ ] 斷線重連機制
- [ ] 錯誤處理優化
- [ ] 房間清理機制
- [ ] 跨瀏覽器測試和修正
- [ ] 效能優化

**完成標準**：
- 動畫流暢，視覺效果良好
- 斷線重連成功率 > 90%
- 無明顯 Bug

### 階段三：進階功能（選用）
**目標**：增加遊戲性和展示度

可選功能：
- [ ] 快速配對系統（不需房間代碼）
- [ ] 遊戲歷史記錄（需要資料庫）
- [ ] 更多題目分類
- [ ] 題目舉報系統
- [ ] 全域排行榜
- [ ] 成就系統
- [ ] 好友系統
- [ ] 聊天室功能
- [ ] 自訂頭像
- [ ] 遊戲回放功能

## 8. 待決定的問題

### 待決定事項
- [ ] 是否加入音效？（可能需要處理自動播放政策）
- [ ] 題庫來源：自己編寫 vs 使用現有 API（如 Open Trivia DB）
- [ ] 是否需要後台管理介面來管理題目？
- [ ] 斷線玩家是否允許觀戰模式？
- [ ] 是否加入練習模式（單人）？

### 假設
- 使用免費的部署平台足以支撐展示需求
- 不需要資料庫，記憶體儲存即可（階段一）
- 玩家不會刻意作弊或惡意攻擊
- 題庫版權問題已處理（使用自創或公開題庫）
- 不需要考慮 SEO（單頁應用）

## 9. 未來增強功能

### 短期（階段三）
- 快速配對系統
- 更豐富的題庫（500+ 題）
- 遊戲歷史記錄
- 全域排行榜

### 中期（3-6 個月）
- 使用者帳號系統
- 好友系統
- 自訂題目功能
- 多語言支援
- PWA 支援（可安裝到手機）

### 長期（6 個月以上）
- 錦標賽模式
- 隊伍對戰模式
- 即時語音聊天
- AI 題目生成
- 題目編輯器（讓玩家創建題目）
- 行動 App（Vue Native 或 Ionic Vue）

## 10. 風險評估

### 技術風險
| 風險 | 影響 | 機率 | 緩解措施 |
|------|------|------|----------|
| WebSocket 連線不穩定 | 高 | 中 | 實作重連機制、提供降級方案 |
| 免費部署平台限制 | 中 | 中 | 選擇合適平台、準備升級計畫 |
| 跨瀏覽器相容性問題 | 中 | 低 | 早期測試、使用成熟的套件 |
| 效能問題（多人同步） | 高 | 低 | 優化訊息傳輸、限制房間人數 |

### 產品風險
| 風險 | 影響 | 機率 | 緩解措施 |
|------|------|------|----------|
| 題庫版權問題 | 高 | 低 | 使用自創或公開題庫 |
| 玩家作弊 | 中 | 中 | 伺服器端驗證、限制重要邏輯在前端 |
| 使用者體驗不佳 | 高 | 低 | 早期測試、收集回饋 |

---

**最後更新**: 2025-10-18
**版本**: 1.0
**預計開發時間**: 2-4 週（含測試和部署）
